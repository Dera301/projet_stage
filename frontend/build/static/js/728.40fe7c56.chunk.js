"use strict";(self.webpackChunkcolocation_antananarivo=self.webpackChunkcolocation_antananarivo||[]).push([[728],{2692:(e,t,s)=>{s.d(t,{A:()=>d});var r=s(5043),a=s(7988),n=s(7591),l=s(4558),i=s(2339),o=s(9741),c=s(579);const d=e=>{let{isOpen:t,onClose:s,propertyId:d,ownerId:u,propertyTitle:m,appointment:p,onUpdate:x}=e;const{user:h}=(0,o.A)(),[g,f]=(0,r.useState)(""),[y,b]=(0,r.useState)(""),[v,j]=(0,r.useState)(""),[w,N]=(0,r.useState)(!1),[A,k]=(0,r.useState)([]),[C,E]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&h&&(async()=>{if(h){E(!0);try{const e=await(0,l.apiGet)("/api/appointments/get_all");e.success&&k(e.data||[])}catch(e){console.error("Erreur lors du chargement des rendez-vous existants")}finally{E(!1)}}})()},[t,h]),(0,r.useEffect)(()=>{if(p){const e=new Date(p.appointmentDate);f(e.toISOString().split("T")[0]),b(e.toTimeString().slice(0,5)),j(p.message)}else f(""),b(""),j("")},[p]);const T=(e,t)=>{const s=new Date("".concat(e,"T").concat(t,":00")),r=new Date;return A.some(e=>{if(e.id===(null===p||void 0===p?void 0:p.id))return!1;const t=new Date(e.appointmentDate);if(t.getTime()<r.getTime())return!1;if("completed"===e.status)return!1;return Math.abs(s.getTime()-t.getTime())/36e5<2&&"cancelled"!==e.status})};if(!t)return null;const z=(new Date).toISOString().split("T")[0],S=new Date;S.setDate(S.getDate()+30);const I=S.toISOString().split("T")[0];return(0,c.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,c.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,c.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:p?"Modifier la visite":"Planifier une visite"}),(0,c.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,c.jsx)(n.A,{className:"w-6 h-6"})})]}),(0,c.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),g&&y)if(h)if(T(g,y))i.Ay.error("Ce cr\xe9neau horaire est d\xe9j\xe0 r\xe9serv\xe9. Veuillez choisir un autre horaire.");else{N(!0);try{const e="".concat(g,"T").concat(y,":00");if(p&&x)await x({appointmentDate:e,message:v||'Je souhaite visiter le logement "'.concat(m,'"')});else{const t=await(0,l.apiJson)("/api/appointments/create","POST",{propertyId:d,appointmentDate:e,message:v||'Je souhaite visiter le logement "'.concat(m,'"')});t.success?(i.Ay.success("Rendez-vous planifi\xe9 avec succ\xe8s !"),s()):i.Ay.error(t.message||"Erreur lors de la planification")}}catch(t){console.error("Erreur:",t),i.Ay.error("Erreur lors de la planification du rendez-vous")}finally{N(!1)}}else i.Ay.error("Veuillez vous connecter pour planifier un rendez-vous");else i.Ay.error("Veuillez s\xe9lectionner une date et une heure")},className:"p-6 space-y-6",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Logement"}),(0,c.jsx)("p",{className:"text-gray-900 font-medium",children:m})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700 mb-2",children:"Date de visite *"}),(0,c.jsxs)("div",{className:"relative",children:[(0,c.jsx)(a.A,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"}),(0,c.jsx)("input",{type:"date",id:"date",required:!0,min:z,max:I,value:g,onChange:e=>f(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Heure de visite *"}),C?(0,c.jsx)("div",{className:"flex justify-center py-4",children:(0,c.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"})}):(0,c.jsx)("div",{className:"grid grid-cols-2 gap-2",children:["08:00","09:00","10:00","11:00","14:00","15:00","16:00","17:00"].map(e=>{const t=!!g&&T(g,e);return(0,c.jsxs)("button",{type:"button",onClick:()=>!t&&b(e),disabled:t,className:"p-3 border rounded-lg text-sm font-medium transition-colors ".concat(y===e?"border-primary-500 bg-primary-50 text-primary-700":t?"border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed":"border-gray-300 text-gray-700 hover:border-primary-400"),title:t?"Cr\xe9neau indisponible":"",children:[e,t&&(0,c.jsx)("div",{className:"text-xs text-red-500 mt-1",children:"Indisponible"})]},e)})})]}),(0,c.jsxs)("div",{children:[(0,c.jsx)("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 mb-2",children:"Message au propri\xe9taire (optionnel)"}),(0,c.jsx)("textarea",{id:"message",rows:4,value:v,onChange:e=>j(e.target.value),placeholder:"Bonjour, je souhaite visiter votre logement...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),(0,c.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,c.jsx)("button",{type:"button",onClick:s,className:"flex-1 btn-secondary",children:"Annuler"}),(0,c.jsx)("button",{type:"submit",disabled:w||!g||!y||C,className:"flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:w?p?"Modification...":"Planification...":p?"Modifier":"Confirmer"})]})]})]})})}},2811:(e,t,s)=>{s.d(t,{A:()=>i});var r=s(3986),a=s(5043);const n=["title","titleId"];function l(e,t){let{title:s,titleId:l}=e,i=(0,r.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},i),s?a.createElement("title",{id:l},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))}const i=a.forwardRef(l)},5861:(e,t,s)=>{s.d(t,{A:()=>i});var r=s(3986),a=s(5043);const n=["title","titleId"];function l(e,t){let{title:s,titleId:l}=e,i=(0,r.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},i),s?a.createElement("title",{id:l},s):null,a.createElement("path",{fillRule:"evenodd",d:"M16.5 4.478v.227a48.816 48.816 0 0 1 3.878.512.75.75 0 1 1-.256 1.478l-.209-.035-1.005 13.07a3 3 0 0 1-2.991 2.77H8.084a3 3 0 0 1-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 0 1-.256-1.478A48.567 48.567 0 0 1 7.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 0 1 3.369 0c1.603.051 2.815 1.387 2.815 2.951Zm-6.136-1.452a51.196 51.196 0 0 1 3.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 0 0-6 0v-.113c0-.794.609-1.428 1.364-1.452Zm-.355 5.945a.75.75 0 1 0-1.5.058l.347 9a.75.75 0 1 0 1.499-.058l-.346-9Zm5.48.058a.75.75 0 1 0-1.498-.058l-.347 9a.75.75 0 0 0 1.5.058l.345-9Z",clipRule:"evenodd"}))}const i=a.forwardRef(l)},7459:(e,t,s)=>{s.d(t,{A:()=>i});var r=s(3986),a=s(5043);const n=["title","titleId"];function l(e,t){let{title:s,titleId:l}=e,i=(0,r.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},i),s?a.createElement("title",{id:l},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"}))}const i=a.forwardRef(l)},7591:(e,t,s)=>{s.d(t,{A:()=>i});var r=s(3986),a=s(5043);const n=["title","titleId"];function l(e,t){let{title:s,titleId:l}=e,i=(0,r.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},i),s?a.createElement("title",{id:l},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const i=a.forwardRef(l)},7988:(e,t,s)=>{s.d(t,{A:()=>i});var r=s(3986),a=s(5043);const n=["title","titleId"];function l(e,t){let{title:s,titleId:l}=e,i=(0,r.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},i),s?a.createElement("title",{id:l},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"}))}const i=a.forwardRef(l)},9422:(e,t,s)=>{s.d(t,{A:()=>i});var r=s(3986),a=s(5043);const n=["title","titleId"];function l(e,t){let{title:s,titleId:l}=e,i=(0,r.A)(e,n);return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},i),s?a.createElement("title",{id:l},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))}const i=a.forwardRef(l)},9728:(e,t,s)=>{s.r(t),s.d(t,{default:()=>g});var r=s(9379),a=s(5043),n=s(9741),l=s(4558),i=s(7988),o=s(9422),c=s(7459),d=s(2811),u=s(7591),m=s(5861),p=s(2339),x=s(2692),h=s(579);const g=()=>{const{user:e}=(0,n.A)(),[t,s]=(0,a.useState)([]),[g,f]=(0,a.useState)(!1),[y,b]=(0,a.useState)(null),[v,j]=(0,a.useState)(!1),[w,N]=(0,a.useState)(!1),[A,k]=(0,a.useState)(""),[C,E]=(0,a.useState)(null),T=(0,a.useCallback)(async()=>{if(e){f(!0);try{const e=await(0,l.apiGet)("/api/appointments/get_all");if(e.success){const t=e.data||[];s(t.filter(e=>"cancelled"!==e.status))}}catch(t){p.Ay.error("Erreur lors du chargement des rendez-vous")}finally{f(!1)}}},[e]);(0,a.useEffect)(()=>{e&&T()},[e,T]);const z=async(e,t,a)=>{try{const n={status:t};a&&(n.cancellationReason=a);(await(0,l.apiJson)("/api/appointments/update_status/".concat(e),"PUT",n)).success&&(p.Ay.success("Statut mis \xe0 jour"),s(s=>s.map(s=>s.id===e?(0,r.A)((0,r.A)({},s),{},{status:t}):s)),"cancelled"===t&&s(t=>t.filter(t=>t.id!==e)))}catch(n){p.Ay.error(n.message||"Erreur lors de la mise \xe0 jour")}},S=e=>{E(e),N(!0),k("")};if(!e)return(0,h.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"Veuillez vous connecter"});const I=e=>({pending:"En attente",confirmed:"Confirm\xe9",cancelled:"Annul\xe9",completed:"Termin\xe9"}[e]||e),L=e=>{const t=new Date(e.appointmentDate),s=new Date;return(t.getTime()-s.getTime())/36e5>2&&"cancelled"!==e.status&&"completed"!==e.status};return(0,h.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 py-8",children:[(0,h.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,h.jsxs)("div",{className:"mb-8",children:[(0,h.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Mes Rendez-vous"}),(0,h.jsx)("p",{className:"text-gray-600",children:"student"===e.userType?"G\xe9rez vos rendez-vous avec les propri\xe9taires":"G\xe9rez les rendez-vous pour vos propri\xe9t\xe9s"})]}),g?(0,h.jsx)("div",{className:"flex justify-center py-12",children:(0,h.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):0===t.length?(0,h.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 text-center py-12",children:[(0,h.jsx)(i.A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,h.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun rendez-vous"}),(0,h.jsx)("p",{className:"text-gray-600",children:"student"===e.userType?"Vous n'avez pas encore de rendez-vous planifi\xe9":"Aucun \xe9tudiant n'a demand\xe9 de rendez-vous"})]}):(0,h.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(t=>{return(0,h.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow",children:[(0,h.jsx)("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200",children:(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat((a=t.status,{pending:"bg-yellow-100 text-yellow-800 border-yellow-200",confirmed:"bg-green-100 text-green-800 border-green-200",cancelled:"bg-red-100 text-red-800 border-red-200",completed:"bg-blue-100 text-blue-800 border-blue-200"}[a]||"bg-gray-100 text-gray-800")),children:I(t.status)}),(0,h.jsxs)("div",{className:"flex items-center space-x-1",children:[L(t)&&(0,h.jsx)("button",{onClick:()=>(e=>{b(e),j(!0)})(t),className:"text-gray-400 hover:text-primary-600 transition-colors p-1",title:"Modifier",children:(0,h.jsx)(d.A,{className:"w-4 h-4"})}),(0,h.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\xcates-vous s\xfbr de vouloir supprimer ce rendez-vous ?"))try{(await(0,l.apiJson)("/api/appointments/update_status/".concat(e),"PUT",{status:"cancelled"})).success&&(p.Ay.success("Rendez-vous annul\xe9"),s(t=>t.filter(t=>t.id!==e)))}catch(t){p.Ay.error("Erreur lors de la suppression")}})(t.id),className:"text-gray-400 hover:text-red-600 transition-colors p-1",title:"Supprimer",children:(0,h.jsx)(m.A,{className:"w-4 h-4"})})]})]})}),(0,h.jsxs)("div",{className:"p-4",children:[(0,h.jsx)("h3",{className:"font-semibold text-gray-900 mb-2 line-clamp-2",children:t.propertyTitle}),t.address&&(0,h.jsxs)("div",{className:"flex items-center text-sm text-gray-600 mb-3",children:[(0,h.jsx)(c.A,{className:"w-4 h-4 mr-1 flex-shrink-0"}),(0,h.jsx)("span",{className:"truncate",children:t.address})]}),(0,h.jsxs)("div",{className:"flex items-center text-sm text-gray-600 mb-3",children:[(0,h.jsx)(i.A,{className:"w-4 h-4 mr-2 flex-shrink-0"}),(0,h.jsx)("span",{children:(r=t.appointmentDate,new Date(r).toLocaleString("fr-FR",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]}),(0,h.jsxs)("div",{className:"text-sm text-gray-600 space-y-1 mb-4",children:["owner"===e.userType&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{children:"\xc9tudiant:"})," ",t.studentFirstName," ",t.studentLastName]}),(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{children:"T\xe9l:"})," ",t.studentPhone]})]}),"student"===e.userType&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{children:"Propri\xe9taire:"})," ",t.ownerFirstName," ",t.ownerLastName]}),(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{children:"T\xe9l:"})," ",t.ownerPhone]})]})]}),t.message&&(0,h.jsx)("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:(0,h.jsx)("p",{className:"text-sm text-gray-700 line-clamp-3",children:t.message})}),(0,h.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,h.jsxs)("div",{className:"flex space-x-2",children:["pending"===t.status&&"owner"===e.userType&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("button",{onClick:()=>z(t.id,"confirmed"),className:"flex-1 btn-primary text-sm flex items-center justify-center space-x-1 py-2",children:[(0,h.jsx)(o.A,{className:"w-4 h-4"}),(0,h.jsx)("span",{children:"Confirmer"})]}),(0,h.jsxs)("button",{onClick:()=>S(t),className:"flex-1 btn-secondary text-sm flex items-center justify-center space-x-1 py-2",children:[(0,h.jsx)(u.A,{className:"w-4 h-4"}),(0,h.jsx)("span",{children:"Refuser"})]})]}),"confirmed"===t.status&&"student"===e.userType&&(0,h.jsxs)("button",{onClick:()=>z(t.id,"cancelled"),className:"flex-1 btn-secondary text-sm flex items-center justify-center space-x-1 py-2",children:[(0,h.jsx)(u.A,{className:"w-4 h-4"}),(0,h.jsx)("span",{children:"Annuler"})]}),"confirmed"===t.status&&"owner"===e.userType&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("button",{onClick:()=>z(t.id,"completed"),className:"flex-1 btn-primary text-sm flex items-center justify-center space-x-1 py-2",children:[(0,h.jsx)(o.A,{className:"w-4 h-4"}),(0,h.jsx)("span",{children:"Termin\xe9"})]}),(0,h.jsxs)("button",{onClick:()=>S(t),className:"flex-1 btn-secondary text-sm flex items-center justify-center space-x-1 py-2",children:[(0,h.jsx)(u.A,{className:"w-4 h-4"}),(0,h.jsx)("span",{children:"Annuler"})]})]})]})})]})]},t.id);var r,a})})]}),y&&(0,h.jsx)(x.A,{isOpen:v,onClose:()=>{j(!1),b(null)},propertyId:y.propertyId,ownerId:y.ownerId||"",propertyTitle:y.propertyTitle,appointment:y,onUpdate:async e=>{try{(await(0,l.apiJson)("/api/appointments/update_status/".concat(null===y||void 0===y?void 0:y.id),"PUT",{status:e.status||(null===y||void 0===y?void 0:y.status),message:e.message||(null===y||void 0===y?void 0:y.message)})).success&&(p.Ay.success("Rendez-vous modifi\xe9"),j(!1),b(null),T())}catch(t){p.Ay.error("Erreur lors de la modification")}}}),w&&C&&(0,h.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,h.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,h.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Annuler le rendez-vous"}),(0,h.jsxs)("p",{className:"text-gray-600 mb-4",children:["Vous \xeates sur le point d'annuler le rendez-vous pour \"",C.propertyTitle,'". Veuillez indiquer la raison de cette annulation :']}),(0,h.jsx)("textarea",{value:A,onChange:e=>k(e.target.value),placeholder:"Ex: Indisponibilit\xe9, changement de planning, etc.",className:"w-full p-3 border border-gray-300 rounded-lg mb-4 min-h-[100px]",required:!0}),(0,h.jsxs)("div",{className:"flex space-x-3",children:[(0,h.jsx)("button",{onClick:async()=>{C&&(A.trim()?(await z(C.id,"cancelled",A),N(!1),E(null),k("")):p.Ay.error("Veuillez saisir une raison d'annulation"))},className:"flex-1 btn-primary",children:"Confirmer l'annulation"}),(0,h.jsx)("button",{onClick:()=>{N(!1),E(null),k("")},className:"flex-1 btn-secondary",children:"Annuler"})]})]})})]})}}}]);
//# sourceMappingURL=728.40fe7c56.chunk.js.map