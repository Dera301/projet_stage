"use strict";(self.webpackChunkcolocation_antananarivo=self.webpackChunkcolocation_antananarivo||[]).push([[899],{1602:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(3986),s=r(5043);const n=["title","titleId"];function i(e,t){let{title:r,titleId:i}=e,l=(0,a.A)(e,n);return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":i},l),r?s.createElement("title",{id:i},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))}const l=s.forwardRef(i)},2556:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(3986),s=r(5043);const n=["title","titleId"];function i(e,t){let{title:r,titleId:i}=e,l=(0,a.A)(e,n);return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":i},l),r?s.createElement("title",{id:i},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Zm6-10.125a1.875 1.875 0 1 1-3.75 0 1.875 1.875 0 0 1 3.75 0Zm1.294 6.336a6.721 6.721 0 0 1-3.17.789 6.721 6.721 0 0 1-3.168-.789 3.376 3.376 0 0 1 6.338 0Z"}))}const l=s.forwardRef(i)},5442:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(3986),s=r(5043);const n=["title","titleId"];function i(e,t){let{title:r,titleId:i}=e,l=(0,a.A)(e,n);return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":i},l),r?s.createElement("title",{id:i},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"}))}const l=s.forwardRef(i)},5899:(e,t,r)=>{r.r(t),r.d(t,{default:()=>p});var a=r(5043),s=r(3216),n=r(5475),i=r(9741),l=r(4439),o=r(4558),c=r(2339),d=r(5442),m=r(9399),u=r(2556),h=r(1602),x=r(7591),g=r(579);const f=async e=>{try{var t,r;const a=new FormData;a.append("image",e);const s=await(0,o.yX)("/api/upload/image",a);if(!s.success)throw new Error(s.message||"Erreur lors de l'upload");return(null===(t=s.data)||void 0===t?void 0:t.url)||(null===(r=s.data)||void 0===r?void 0:r.path)||""}catch(a){throw console.error("Erreur upload:",a),new Error(a.message||"Erreur lors de l'upload")}},p=()=>{const{id:e}=(0,s.g)(),{user:t}=(0,i.A)(),p=(0,s.Zp)(),{userAnnouncements:v,updateAnnouncement:b,loading:j}=(0,l.b)(),[w,y]=(0,a.useState)(""),[N,A]=(0,a.useState)(""),[k,E]=(0,a.useState)([]),[I,L]=(0,a.useState)([]),[C,M]=(0,a.useState)(!1),R=(0,a.useRef)(null);if((0,a.useEffect)(()=>{if(!e)return;const a=parseInt(e),s=v.find(e=>Number(e.id)===a);if(s)return y(s.content),A(s.contact||""),void L(s.images||[]);(async()=>{try{var e;const{apiGet:s}=await Promise.resolve().then(r.bind(r,4558)),n=await s("/api/announcements/get_by_id/".concat(a)),i=await n.json();if(!n.ok||!i.success||!i.data)throw new Error(i.message||"Annonce non trouv\xe9e");const l=i.data;if(t&&String(null===(e=l.author)||void 0===e?void 0:e.id)!==String(t.id))return c.Ay.error("Vous ne pouvez pas modifier cette annonce"),void p("/dashboard");y(l.content||""),A(l.contact||""),L(l.images||[])}catch(s){c.Ay.error(s.message||"Annonce non trouv\xe9e"),p("/dashboard")}})()},[e,v,p,t]),!t)return(0,g.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,g.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})});if("student"!==t.userType)return(0,g.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,g.jsxs)("div",{className:"max-w-md w-full text-center",children:[(0,g.jsx)(m.A,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),(0,g.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"R\xe9serv\xe9 aux \xe9tudiants"}),(0,g.jsx)("p",{className:"text-gray-600 mb-4",children:"Seuls les comptes \xe9tudiants peuvent modifier une annonce de colocation."}),(0,g.jsx)("button",{onClick:()=>p("/dashboard"),className:"w-full btn-secondary",children:"Retour"})]})});if(!t.cinVerified)return(0,g.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,g.jsxs)("div",{className:"max-w-md w-full text-center",children:[(0,g.jsx)(m.A,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),(0,g.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"V\xe9rification Requise"}),(0,g.jsx)("p",{className:"text-gray-600 mb-4",children:"Vous devez v\xe9rifier votre CIN avant de pouvoir modifier des annonces."}),(0,g.jsxs)("div",{className:"space-y-3",children:[(0,g.jsxs)(n.N_,{to:"/cin-verification",className:"w-full btn-primary flex items-center justify-center space-x-2",children:[(0,g.jsx)(u.A,{className:"w-5 h-5"}),(0,g.jsx)("span",{children:"V\xe9rifier mon CIN"})]}),(0,g.jsx)("button",{onClick:()=>p("/dashboard"),className:"w-full btn-secondary",children:"Retour au tableau de bord"})]})]})});return(0,g.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,g.jsxs)("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,g.jsxs)("div",{className:"mb-8",children:[(0,g.jsx)("div",{className:"flex items-center mb-4",children:(0,g.jsxs)(n.N_,{to:"/dashboard",className:"flex items-center text-gray-600 hover:text-gray-900 mr-4",children:[(0,g.jsx)(d.A,{className:"w-5 h-5 mr-2"}),"Retour"]})}),(0,g.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Modifier l'annonce de colocation"}),(0,g.jsx)("p",{className:"text-gray-600",children:"Modifiez votre recherche de colocation (quartier, budget, pr\xe9f\xe9rences) et les images."})]}),(0,g.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),w.trim())if(e)try{c.Ay.loading("Modification en cours...");const t=await(async()=>{if(0===k.length)return[];M(!0);try{const e=k.map(e=>e.file);return await Promise.all(e.map(f))}finally{M(!1)}})(),r=[...I,...t],a={content:w.trim(),images:r,contact:N.trim()||void 0};await b(parseInt(e),a),c.Ay.dismiss(),k.forEach(e=>URL.revokeObjectURL(e.preview)),p("/dashboard")}catch(r){c.Ay.dismiss(),c.Ay.error(r.message||"Erreur lors de la modification")}else c.Ay.error("ID d'annonce manquant");else c.Ay.error("Le texte de votre annonce est requis")},className:"space-y-8 bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Texte de l'annonce *"}),(0,g.jsx)("textarea",{value:w,onChange:e=>y(e.target.value),rows:5,className:"input-field",placeholder:"Ex: \xc9tudiant en info, je cherche une colocation \xe0 Isoraka, budget 300 000 Ar, non fumeur...",required:!0})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact (optionnel)"}),(0,g.jsx)("input",{value:N,onChange:e=>A(e.target.value),type:"text",className:"input-field",placeholder:"T\xe9l\xe9phone, email, etc."})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Images (max 6)"}),(0,g.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[(0,g.jsx)("input",{ref:R,type:"file",accept:"image/*",multiple:!0,onChange:e=>{const t=e.target.files;if(!t)return;const r=[];for(let a=0;a<t.length;a++){const e=t[a];if(e.type.startsWith("image/"))if(e.size>5242880)c.Ay.error("".concat(e.name," est trop volumineux (max 5MB)"));else{if(I.length+k.length+r.length>=6){c.Ay.error("Maximum 6 images");break}r.push({file:e,preview:URL.createObjectURL(e),id:Math.random().toString(36).slice(2)})}else c.Ay.error("".concat(e.name," n'est pas une image valide"))}r.length>0&&(E(e=>[...e,...r]),c.Ay.success("".concat(r.length," image(s) ajout\xe9e(s)"))),R.current&&(R.current.value="")},className:"hidden",id:"announcementImages"}),(0,g.jsxs)("label",{htmlFor:"announcementImages",className:"cursor-pointer inline-flex items-center space-x-2 btn-secondary",children:[(0,g.jsx)(h.A,{className:"w-5 h-5"}),(0,g.jsx)("span",{children:"Ajouter des images"})]}),I.length>0&&(0,g.jsxs)("div",{className:"mt-4",children:[(0,g.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Images actuelles"}),(0,g.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:I.map((e,t)=>(0,g.jsxs)("div",{className:"relative",children:[(0,g.jsx)("img",{src:(0,o.VG)(e),alt:"existing-".concat(t),className:"w-full h-32 object-cover rounded-lg"}),(0,g.jsx)("button",{type:"button",onClick:()=>{return e=t,void L(t=>t.filter((t,r)=>r!==e));var e},className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:(0,g.jsx)(x.A,{className:"w-4 h-4"})})]},t))})]}),k.length>0&&(0,g.jsxs)("div",{className:"mt-4",children:[(0,g.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Nouvelles images"}),(0,g.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:k.map((e,t)=>(0,g.jsxs)("div",{className:"relative",children:[(0,g.jsx)("img",{src:e.preview,alt:"preview",className:"w-full h-32 object-cover rounded-lg"}),(0,g.jsx)("button",{type:"button",onClick:()=>{return e=t,URL.revokeObjectURL(k[e].preview),void E(t=>t.filter((t,r)=>r!==e));var e},className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:(0,g.jsx)(x.A,{className:"w-4 h-4"})})]},e.id))})]}),(I.length>0||k.length>0)&&(0,g.jsxs)("div",{className:"mt-3 text-sm text-gray-500",children:[I.length+k.length," / 6 images"]})]})]}),(0,g.jsxs)("div",{className:"flex space-x-3",children:[(0,g.jsx)("button",{type:"button",onClick:()=>p("/dashboard"),className:"btn-secondary",disabled:C||j,children:"Annuler"}),(0,g.jsx)("button",{type:"submit",disabled:C||j||!w.trim(),className:"btn-primary",children:C||j?"Modification...":"Modifier"})]})]})]})})}},7591:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(3986),s=r(5043);const n=["title","titleId"];function i(e,t){let{title:r,titleId:i}=e,l=(0,a.A)(e,n);return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":i},l),r?s.createElement("title",{id:i},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const l=s.forwardRef(i)},9399:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(3986),s=r(5043);const n=["title","titleId"];function i(e,t){let{title:r,titleId:i}=e,l=(0,a.A)(e,n);return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":i},l),r?s.createElement("title",{id:i},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))}const l=s.forwardRef(i)}}]);
//# sourceMappingURL=899.b00e0fe6.chunk.js.map