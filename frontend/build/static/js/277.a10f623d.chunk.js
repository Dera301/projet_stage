"use strict";(self.webpackChunkcolocation_antananarivo=self.webpackChunkcolocation_antananarivo||[]).push([[277],{1602:(e,s,r)=>{r.d(s,{A:()=>n});var a=r(3986),t=r(5043);const i=["title","titleId"];function l(e,s){let{title:r,titleId:l}=e,n=(0,a.A)(e,i);return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":l},n),r?t.createElement("title",{id:l},r):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))}const n=t.forwardRef(l)},2277:(e,s,r)=>{r.r(s),r.d(s,{default:()=>x});var a=r(9379),t=r(5043),i=r(3216),l=r(5475),n=r(129),o=r(9741),d=r(4558),c=r(5442),m=r(1602),u=r(7591),p=r(2339),h=r(579);const x=()=>{const{id:e}=(0,i.g)(),s=(0,i.Zp)(),{userProperties:x,fetchPropertyById:g,loading:b}=(0,n.N)(),{user:v}=(0,o.A)(),[f,y]=(0,t.useState)(null),[j,N]=(0,t.useState)({title:"",description:"",address:"",district:"",price:0,deposit:0,availableRooms:1,totalRooms:1,propertyType:"apartment",amenities:[],images:[],isAvailable:!0,latitude:0,longitude:0}),[w,A]=(0,t.useState)([]),[k,E]=(0,t.useState)([]),[R,C]=(0,t.useState)(!1),L=t.useRef(null);(0,t.useEffect)(()=>{(async()=>{if(e)try{let r=x.find(s=>s.id===e);if(!r){r=await g(e)||void 0}r?(y(r),N({title:r.title||"",description:r.description||"",address:r.address||"",district:r.district||"",price:r.price||0,deposit:r.deposit||0,availableRooms:r.availableRooms||1,totalRooms:r.totalRooms||1,propertyType:r.propertyType||"apartment",amenities:r.amenities||[],images:r.images||[],isAvailable:!1!==r.isAvailable,latitude:r.latitude||0,longitude:r.longitude||0}),E(r.images||[])):(p.Ay.error("Propri\xe9t\xe9 non trouv\xe9e"),s("/dashboard"))}catch(r){console.error("Erreur lors du chargement:",r),p.Ay.error("Erreur lors du chargement de la propri\xe9t\xe9"),s("/dashboard")}})()},[e,x,g,s]);const q=e=>{const{name:s,value:r,type:t}=e.target;N(i=>(0,a.A)((0,a.A)({},i),{},{[s]:"checkbox"===t?e.target.checked:"price"===s||"deposit"===s||"availableRooms"===s||"totalRooms"===s||"latitude"===s||"longitude"===s?Number(r):r}))};return f?(0,h.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,h.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,h.jsxs)("div",{className:"mb-8",children:[(0,h.jsx)("div",{className:"flex items-center mb-4",children:(0,h.jsxs)(l.N_,{to:"/dashboard",className:"flex items-center text-gray-600 hover:text-gray-900 mr-4",children:[(0,h.jsx)(c.A,{className:"w-5 h-5 mr-2"}),"Retour"]})}),(0,h.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Modifier le logement"}),(0,h.jsx)("p",{className:"text-gray-600",children:"Modifiez les informations de votre logement"})]}),(0,h.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),v&&f)if(j.title.trim())if(j.description.trim())if(j.address.trim())if(j.district)if(j.price<=0)p.Ay.error("Le prix doit \xeatre sup\xe9rieur \xe0 0");else try{let e=[...k];if(w.length>0){p.Ay.loading("Upload des nouvelles images...");const s=await(async()=>{if(0===w.length)return[];C(!0);try{const e=async e=>{const s=new FormData;s.append("image",e);try{var r,a;const e=await(0,d.yX)("/api/upload/image",s);if(!e.success)throw new Error(e.message||"Erreur lors de l'upload");return(null===(r=e.data)||void 0===r?void 0:r.url)||(null===(a=e.data)||void 0===a?void 0:a.path)||""}catch(t){throw console.error("Erreur upload:",t),new Error(t.message||"Erreur lors de l'upload")}},s=w.map(s=>e(s.file)),r=(await Promise.all(s)).filter(e=>e&&""!==e);return r.length>0&&p.Ay.success("".concat(r.length," image(s) upload\xe9e(s) avec succ\xe8s")),r}catch(e){throw console.error("Erreur upload:",e),p.Ay.error("Erreur lors de l'upload des images: ".concat(e.message)),e}finally{C(!1)}})();e=[...k,...s],p.Ay.dismiss()}const t=(0,a.A)((0,a.A)({},j),{},{images:e}),{apiJson:i}=await Promise.resolve().then(r.bind(r,4558)),l=await i("/api/properties/update/".concat(f.id),"PUT",t);if(!l.success)throw new Error(l.message||"Erreur inconnue lors de la mise \xe0 jour");w.forEach(e=>URL.revokeObjectURL(e.preview)),p.Ay.success("Propri\xe9t\xe9 modifi\xe9e avec succ\xe8s !"),s("/dashboard")}catch(t){console.error("Erreur lors de la modification:",t),t instanceof Error?p.Ay.error("Erreur: ".concat(t.message)):p.Ay.error("Erreur inconnue: ".concat(String(t)))}else p.Ay.error("Le quartier est requis");else p.Ay.error("L'adresse est requise");else p.Ay.error("La description est requise");else p.Ay.error("Le titre est requis");else p.Ay.error("Erreur: utilisateur non connect\xe9 ou propri\xe9t\xe9 non charg\xe9e")},className:"space-y-8",children:[(0,h.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,h.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Informations de base"}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,h.jsxs)("div",{className:"md:col-span-2",children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Titre de l'annonce *"}),(0,h.jsx)("input",{type:"text",name:"title",value:j.title,onChange:q,className:"input-field",placeholder:"Ex: Appartement 3 chambres \xe0 Analakely",required:!0})]}),(0,h.jsxs)("div",{className:"md:col-span-2",children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),(0,h.jsx)("textarea",{name:"description",value:j.description,onChange:q,rows:4,className:"input-field",placeholder:"D\xe9crivez votre logement, ses avantages, le quartier...",required:!0})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type de logement *"}),(0,h.jsx)("select",{name:"propertyType",value:j.propertyType,onChange:q,className:"input-field",required:!0,children:[{value:"apartment",label:"Appartement"},{value:"house",label:"Maison"},{value:"studio",label:"Studio"}].map(e=>(0,h.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quartier *"}),(0,h.jsxs)("select",{name:"district",value:j.district,onChange:q,className:"input-field",required:!0,children:[(0,h.jsx)("option",{value:"",children:"S\xe9lectionnez un quartier"}),["Analakely","Ambohijatovo","Ankadifotsy","Ankatso","Antaninarenina","Behoririka","Isoraka","Mahamasina","Tsaralalana","67ha"].map(e=>(0,h.jsx)("option",{value:e,children:e},e))]})]}),(0,h.jsxs)("div",{className:"md:col-span-2",children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adresse compl\xe8te *"}),(0,h.jsx)("input",{type:"text",name:"address",value:j.address,onChange:q,className:"input-field",placeholder:"Ex: Rue de l'Ind\xe9pendance, Analakely, Antananarivo",required:!0})]}),(0,h.jsx)("div",{className:"md:col-span-2",children:(0,h.jsxs)("label",{className:"flex items-center",children:[(0,h.jsx)("input",{type:"checkbox",name:"isAvailable",checked:j.isAvailable,onChange:q,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),(0,h.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Logement disponible"})]})})]})]}),(0,h.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,h.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Tarification"}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Prix mensuel (Ar) *"}),(0,h.jsx)("input",{type:"number",name:"price",value:j.price||"",onChange:q,className:"input-field",placeholder:"200000",min:"1",required:!0})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Caution (Ar) *"}),(0,h.jsx)("input",{type:"number",name:"deposit",value:j.deposit||"",onChange:q,className:"input-field",placeholder:"100000",min:"0",required:!0})]})]})]}),(0,h.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,h.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Chambres"}),(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre total de chambres *"}),(0,h.jsx)("input",{type:"number",name:"totalRooms",value:j.totalRooms,onChange:q,className:"input-field",min:"1",required:!0})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Chambres disponibles *"}),(0,h.jsx)("input",{type:"number",name:"availableRooms",value:j.availableRooms,onChange:q,className:"input-field",min:"1",max:j.totalRooms,required:!0})]})]})]}),(0,h.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,h.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Photos"}),(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-2",children:[(0,h.jsx)("input",{ref:L,type:"file",accept:"image/*",multiple:!0,onChange:e=>{const s=e.target.files;if(!s)return;const r=[];for(let a=0;a<s.length;a++){const e=s[a];if(!e.type.startsWith("image/")){p.Ay.error("".concat(e.name," n'est pas une image valide"));continue}if(e.size>5242880){p.Ay.error("".concat(e.name," est trop volumineux (max 5MB)"));continue}if(w.length+r.length>=10){p.Ay.error("Maximum 10 images autoris\xe9es");break}const t={file:e,preview:URL.createObjectURL(e),id:Math.random().toString(36).substr(2,9)};r.push(t)}r.length>0&&(A(e=>[...e,...r]),p.Ay.success("".concat(r.length," image(s) ajout\xe9e(s) avec succ\xe8s"))),L.current&&(L.current.value="")},className:"hidden"}),(0,h.jsxs)("button",{type:"button",onClick:()=>{var e;return null===(e=L.current)||void 0===e?void 0:e.click()},className:"btn-primary flex items-center justify-center space-x-2 px-4 py-2",disabled:R||b,children:[(0,h.jsx)(m.A,{className:"w-5 h-5"}),(0,h.jsx)("span",{children:"Ajouter des images"})]}),(0,h.jsx)("div",{className:"flex-1 text-sm text-gray-500",children:(0,h.jsx)("p",{children:"Formats accept\xe9s: JPG, PNG, WebP \u2022 Max 5MB par image"})})]}),k.length>0&&(0,h.jsxs)("div",{children:[(0,h.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Images actuelles"}),(0,h.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:k.map((e,s)=>(0,h.jsxs)("div",{className:"relative group bg-gray-100 rounded-lg overflow-hidden",children:[(0,h.jsx)("img",{src:(0,d.VG)(e),alt:"".concat(s+1),className:"w-full h-32 object-cover"}),(0,h.jsx)("button",{type:"button",onClick:()=>(e=>{E(s=>s.filter((s,r)=>r!==e)),N(s=>(0,a.A)((0,a.A)({},s),{},{images:s.images.filter((s,r)=>r!==e)})),p.Ay.success("Image supprim\xe9e")})(s),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",title:"Supprimer l'image",children:(0,h.jsx)(u.A,{className:"w-4 h-4"})})]},s))})]}),w.length>0&&(0,h.jsxs)("div",{children:[(0,h.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Nouvelles images"}),(0,h.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:w.map((e,s)=>(0,h.jsxs)("div",{className:"relative group bg-gray-100 rounded-lg overflow-hidden",children:[(0,h.jsx)("img",{src:e.preview,alt:"".concat(s+1),className:"w-full h-32 object-cover"}),(0,h.jsx)("button",{type:"button",onClick:()=>(e=>{URL.revokeObjectURL(w[e].preview),A(s=>s.filter((s,r)=>r!==e)),p.Ay.success("Image supprim\xe9e")})(s),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",title:"Supprimer l'image",children:(0,h.jsx)(u.A,{className:"w-4 h-4"})})]},e.id))})]})]})]}),(0,h.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,h.jsx)("button",{type:"button",onClick:()=>s("/dashboard"),className:"btn-secondary",disabled:b||R,children:"Annuler"}),(0,h.jsx)("button",{type:"submit",disabled:b||R,className:"btn-primary flex items-center space-x-2",children:b||R?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,h.jsx)("span",{children:R?"Upload...":"Modification..."})]}):"Modifier le logement"})]})]})]})}):(0,h.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,h.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})})}},5442:(e,s,r)=>{r.d(s,{A:()=>n});var a=r(3986),t=r(5043);const i=["title","titleId"];function l(e,s){let{title:r,titleId:l}=e,n=(0,a.A)(e,i);return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":l},n),r?t.createElement("title",{id:l},r):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"}))}const n=t.forwardRef(l)},7591:(e,s,r)=>{r.d(s,{A:()=>n});var a=r(3986),t=r(5043);const i=["title","titleId"];function l(e,s){let{title:r,titleId:l}=e,n=(0,a.A)(e,i);return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":l},n),r?t.createElement("title",{id:l},r):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const n=t.forwardRef(l)}}]);
//# sourceMappingURL=277.a10f623d.chunk.js.map